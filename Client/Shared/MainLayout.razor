@inherits LayoutComponentBase
@using MudBlazor
@using Safir.Shared.Constants;
@inject ThemeService ThemeService
@inject AuthenticationStateProvider AuthenticationStateProvider

<MudLayout>
    <MudAppBar Elevation="1" Color="Color.Primary">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
        <MudText Typo="Typo.h5" Class="ml-3">سفیر</MudText>
        <MudSpacer />
        <MudToggleIconButton @bind-Toggled="@ThemeService.IsDarkMode"
                             Icon="@Icons.Material.Filled.LightMode" Color="Color.Inherit" Title="Light Mode"
                             ToggledIcon="@Icons.Material.Filled.DarkMode" ToggledColor="Color.Inherit" ToggledTitle="Dark Mode" />
        <MudIconButton Icon="@Icons.Material.Filled.Notifications" Color="Color.Inherit" />

        <MudIconButton Icon="@Icons.Material.Filled.Person" Color="Color.Inherit" />

        @* User Logged in *@
        <AuthorizeView>
            <Authorized Context="authContext">
                <MudText Class="ml-2" Typo="Typo.subtitle2">
                    @authContext.User.FindFirst(BaseknowClaimTypes.UUSER)?.Value
                </MudText>
            </Authorized>
        </AuthorizeView>

    </MudAppBar>


    <MudDrawer @bind-Open="_drawerOpen"
               Anchor="Anchor.End"
               Elevation="2"
               ClipMode="DrawerClipMode.Always"
               Variant="DrawerVariant.Responsive"
               Class="mud-theme-background">

        <MudDrawerHeader>
            <MudText Typo="Typo.h6">منو</MudText>
        </MudDrawerHeader>

        @* Items: *@
        <NavMenu />

    </MudDrawer>

    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.Large" Class="my-4 pt-4">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;

    private void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    private string? displayName;
    private string? userId;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity != null && user.Identity.IsAuthenticated)
        {
            displayName = user.FindFirst(BaseknowClaimTypes.UUSER)?.Value ?? "";
        }
    }
}
